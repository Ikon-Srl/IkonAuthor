--
-- creazione della tabella per l'accumulazione degli hitlog
--

SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO

CREATE TABLE [dbo].[IKG_HITACC](
	[rNode] [int] NOT NULL,
	[Category] [int] NOT NULL,
	[Hits] [int] NULL,
	[Value] [float] NULL,
	[LastUpdate] [datetime] NOT NULL,
 CONSTRAINT [PK_IKG_HITACC] PRIMARY KEY CLUSTERED 
(
	[rNode] ASC,
	[Category] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY]

GO

ALTER TABLE [dbo].[IKG_HITACC]  WITH CHECK ADD  CONSTRAINT [FK_IKG_HITACC_IKGD_RNODE] FOREIGN KEY([rNode])
REFERENCES [dbo].[IKGD_RNODE] ([code])
ON UPDATE CASCADE
ON DELETE CASCADE
GO

ALTER TABLE [dbo].[IKG_HITACC] CHECK CONSTRAINT [FK_IKG_HITACC_IKGD_RNODE]
GO

ALTER TABLE [dbo].[IKG_HITACC] ADD  CONSTRAINT [DF_IKG_HITACC_Hits]  DEFAULT ((0)) FOR [Hits]
GO

ALTER TABLE [dbo].[IKG_HITACC] ADD  CONSTRAINT [DF_IKG_HITACC_Value]  DEFAULT ((0)) FOR [Value]
GO

ALTER TABLE [dbo].[IKG_HITACC] ADD  CONSTRAINT [DF_IKG_HITACC_LastUpdate]  DEFAULT (getdate()) FOR [LastUpdate]
GO


CREATE NONCLUSTERED INDEX [IX_IKG_HITACC] ON [dbo].[IKG_HITACC] 
(
	[LastUpdate] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, SORT_IN_TEMPDB = OFF, IGNORE_DUP_KEY = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
GO

CREATE NONCLUSTERED INDEX [IX_IKG_HITACC_COVER1] ON [dbo].[IKG_HITACC] 
(
	[rNode] ASC,
	[Category] ASC
)
INCLUDE ( [Hits],
[Value]) WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, SORT_IN_TEMPDB = OFF, IGNORE_DUP_KEY = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
GO





