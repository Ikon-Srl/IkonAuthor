--
-- creazione della tabella per la deserializzazione di IKGD_VDATA
--

-- SELECT name,is_read_committed_snapshot_on FROM sys.databases order by name
-- ALTER DATABASE [XYZ_CMS] SET READ_COMMITTED_SNAPSHOT OFF WITH ROLLBACK IMMEDIATE;


/****** Object:  Table [dbo].[IKGD_VDATA_KEYVALUE]    Script Date: 11/26/2011 10:57:40 ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO

SET ANSI_PADDING ON
GO

CREATE TABLE [dbo].[IKGD_VDATA_KEYVALUE](
	[Id] [int] IDENTITY(1,1) NOT NULL,
	[rNode] [int] NOT NULL,
	[vDataVersion] [int] NOT NULL,
	[flag_published] [bit] NOT NULL,
	[flag_current] [bit] NOT NULL,
	[Level] [int] NOT NULL,
	[Key] [varchar](50) NULL,
	[KeyParent] [varchar](50) NULL,
	[modif] [datetime] NOT NULL,
	[ValueInt] [int] NULL,
	[ValueDouble] [float] NULL,
	[ValueDate] [datetime] NULL,
	[ValueString] [nvarchar](255) NULL,
	[ValueText] [nvarchar](max) NULL,
 CONSTRAINT [PK_IKGD_VDATA_KEYVALUE] PRIMARY KEY NONCLUSTERED 
(
	[Id] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY]

GO

SET ANSI_PADDING OFF
GO

ALTER TABLE [dbo].[IKGD_VDATA_KEYVALUE]  WITH CHECK ADD  CONSTRAINT [FK_IKGD_VDATA_KEYVALUE_IKGD_RNODE] FOREIGN KEY([rNode])
REFERENCES [dbo].[IKGD_RNODE] ([code])
GO

ALTER TABLE [dbo].[IKGD_VDATA_KEYVALUE] CHECK CONSTRAINT [FK_IKGD_VDATA_KEYVALUE_IKGD_RNODE]
GO

ALTER TABLE [dbo].[IKGD_VDATA_KEYVALUE]  WITH CHECK ADD  CONSTRAINT [FK_IKGD_VDATA_KEYVALUE_IKGD_VDATA] FOREIGN KEY([vDataVersion])
REFERENCES [dbo].[IKGD_VDATA] ([version])
ON UPDATE CASCADE
ON DELETE CASCADE
GO

ALTER TABLE [dbo].[IKGD_VDATA_KEYVALUE] CHECK CONSTRAINT [FK_IKGD_VDATA_KEYVALUE_IKGD_VDATA]
GO

ALTER TABLE [dbo].[IKGD_VDATA_KEYVALUE] ADD  CONSTRAINT [DF_IKGD_VDATA_KEYVALUE_flag_current1]  DEFAULT ((0)) FOR [flag_published]
GO

ALTER TABLE [dbo].[IKGD_VDATA_KEYVALUE] ADD  CONSTRAINT [DF_IKGD_VDATA_KEYVALUE_flag_current]  DEFAULT ((0)) FOR [flag_current]
GO

ALTER TABLE [dbo].[IKGD_VDATA_KEYVALUE] ADD  CONSTRAINT [DF_IKGD_KEYVALUE_Level]  DEFAULT ((0)) FOR [Level]
GO

ALTER TABLE [dbo].[IKGD_VDATA_KEYVALUE] ADD  CONSTRAINT [DF_IKGD_VDATA_KEYVALUE_modif]  DEFAULT (getdate()) FOR [modif]
GO


CREATE CLUSTERED INDEX [IX_IKGD_VDATA_KEYVALUE_cluster] ON [dbo].[IKGD_VDATA_KEYVALUE] 
(
	[rNode] ASC,
	[vDataVersion] ASC,
	[flag_published] ASC,
	[flag_current] ASC,
	[Level] ASC,
	[Key] ASC,
	[KeyParent] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, SORT_IN_TEMPDB = OFF, IGNORE_DUP_KEY = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
GO

CREATE NONCLUSTERED INDEX [IX_IKGD_VDATA_KEYVALUE_01] ON [dbo].[IKGD_VDATA_KEYVALUE] 
(
	[rNode] ASC,
	[flag_published] ASC,
	[Level] ASC,
	[Key] ASC,
	[KeyParent] ASC
)
INCLUDE ( [ValueInt],
[ValueDouble],
[ValueDate],
[ValueString]) WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, SORT_IN_TEMPDB = OFF, IGNORE_DUP_KEY = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
GO

CREATE NONCLUSTERED INDEX [IX_IKGD_VDATA_KEYVALUE_02] ON [dbo].[IKGD_VDATA_KEYVALUE] 
(
	[rNode] ASC,
	[flag_current] ASC,
	[Level] ASC,
	[Key] ASC,
	[KeyParent] ASC
)
INCLUDE ( [ValueInt],
[ValueDouble],
[ValueDate],
[ValueString]) WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, SORT_IN_TEMPDB = OFF, IGNORE_DUP_KEY = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
GO



